<div class="profile-page">
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1>My Dashboard</h1>
      <p>Welcome back! Here's what's happening with your account.</p>
    </div>

    <!-- States -->
    <div *ngIf="loading" class="mt-3">Loading profile...</div>
    <div *ngIf="!loading && error" class="mt-3" style="color:#ef4444">{{ error }}</div>

    <ng-container *ngIf="!loading && !error">
      <!-- Profile Header -->
      <section class="profile-header">
        <div class="profile-info">
          <div class="profile-avatar">
            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=3840&h=2160&fit=crop&crop=center" alt="User Avatar">
          </div>
          <div class="profile-details">
            <h1>{{ (user?.nom || '') + ' ' + (user?.['prénom'] || '') }}</h1>
            <p class="user-email">{{ user?.email }}</p>
            <p class="member-since" *ngIf="user?.['createdAt']">Member since {{ user?.['createdAt'] | date }}</p>
            <div class="profile-stats">
              <div class="stat">
                <span class="stat-number">{{ user?.['ordersCount'] || 0 }}</span>
                <span class="stat-label">Orders</span>
              </div>
              <div class="stat">
                <span class="stat-number">{{ user?.['wishlistCount'] || 0 }}</span>
                <span class="stat-label">Wishlist</span>
              </div>
              <div class="stat">
                <span class="stat-number">{{ user?.['rating'] || '—' }}</span>
                <span class="stat-label">Rating</span>
              </div>
            </div>
          </div>
        </div>
        <div class="profile-actions">
          <button class="btn btn-outline" (click)="editProfile()">Edit Profile</button>
          <button class="btn btn-primary" (click)="viewOrders()">View Orders</button>
        </div>
      </section>

      <!-- Profile Navigation -->
      <section class="profile-nav">
        <div class="nav-tabs">
          <button class="nav-tab" [class.active]="activeTab === 'overview'" (click)="switchTab('overview')">Dashboard</button>
          <button class="nav-tab" [class.active]="activeTab === 'orders'" (click)="switchTab('orders')">My Orders</button>
          <button class="nav-tab" [class.active]="activeTab === 'wishlist'" (click)="switchTab('wishlist')">Wishlist</button>
          <button class="nav-tab" [class.active]="activeTab === 'settings'" (click)="switchTab('settings')">Settings</button>
        </div>
      </section>

      <!-- Profile Content -->
      <section class="profile-content">
        <!-- Dashboard Overview Tab -->
        <div class="tab-content" [class.active]="activeTab === 'overview'" *ngIf="activeTab === 'overview'">
          <div class="overview-grid">
            <div class="overview-card">
              <h3>Recent Orders</h3>
              <div class="recent-orders" *ngIf="user?.['recentOrders']?.length; else noOrders">
                <div class="order-item" *ngFor="let o of user?.['recentOrders']">
                  <div class="order-image">
                    <img [src]="o.imageUrl" alt="Order">
                  </div>
                  <div class="order-info">
                    <h4>{{ o.title }}</h4>
                    <p class="order-date">Ordered on {{ o.date | date }}</p>
                    <span class="order-status delivered">{{ o.status }}</span>
                  </div>
                  <div class="order-price">{{ o.total | currency }}</div>
                </div>
              </div>
              <ng-template #noOrders>
                <p>No recent orders.</p>
              </ng-template>
            </div>

            <div class="overview-card">
              <h3>Wishlist</h3>
              <div class="wishlist-items" *ngIf="user?.['wishlist']?.length; else noWishlist">
                <div class="wishlist-item" *ngFor="let w of user?.['wishlist']">
                  <div class="wishlist-image">
                    <img [src]="w.imageUrl" alt="Wishlist Item">
                  </div>
                  <div class="wishlist-info">
                    <h4>{{ w.title }}</h4>
                    <p class="wishlist-price">{{ w.price | currency }}</p>
                  </div>
                  <button class="remove-wishlist">×</button>
                </div>
              </div>
              <ng-template #noWishlist>
                <p>No items in wishlist.</p>
              </ng-template>
            </div>

            <div class="overview-card">
              <h3>Account Summary</h3>
              <div class="account-summary">
                <div class="summary-item">
                  <span class="summary-label">Full Name</span>
                  <span class="summary-value">{{ (user?.nom || '') + ' ' + (user?.['prénom'] || '') }}</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Email</span>
                  <span class="summary-value">{{ user?.email }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Orders Tab -->
        <div class="tab-content" [class.active]="activeTab === 'orders'" *ngIf="activeTab === 'orders'">
          <div class="orders-section">
            <h2>My Orders</h2>
            <div class="orders-list">
              <div class="order-card" *ngIf="user?.['recentOrders']?.length; else noOrdersFound">
                <div class="order-item" *ngFor="let order of user?.['recentOrders']">
                  <div class="order-header">
                    <span class="order-id">Order #{{ order.id || 'N/A' }}</span>
                    <span class="order-date">{{ order.date | date }}</span>
                  </div>
                  <div class="order-details">
                    <span class="order-status" [class]="order.status?.toLowerCase()">{{ order.status }}</span>
                    <span class="order-total">{{ order.total | currency }}</span>
                  </div>
                </div>
              </div>
              <ng-template #noOrdersFound>
                <div class="empty-state">
                  <p>You haven't placed any orders yet.</p>
                  <a routerLink="/products" class="btn btn-primary">Start Shopping</a>
                </div>
              </ng-template>
            </div>
          </div>
        </div>

        <!-- Wishlist Tab -->
        <div class="tab-content" [class.active]="activeTab === 'wishlist'" *ngIf="activeTab === 'wishlist'">
          <div class="wishlist-section">
            <h2>My Wishlist</h2>
            <div class="wishlist-grid" *ngIf="user?.['wishlist']?.length; else noWishlistItems">
              <div class="wishlist-card" *ngFor="let item of user?.['wishlist']">
                <img [src]="item.imageUrl" [alt]="item.title">
                <h4>{{ item.title }}</h4>
                <p class="price">{{ item.price | currency }}</p>
                <div class="wishlist-actions">
                  <button class="btn btn-primary btn-sm">Add to Cart</button>
                  <button class="btn btn-outline btn-sm">Remove</button>
                </div>
              </div>
            </div>
            <ng-template #noWishlistItems>
              <div class="empty-state">
                <p>Your wishlist is empty.</p>
                <a routerLink="/products" class="btn btn-primary">Browse Products</a>
              </div>
            </ng-template>
          </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" [class.active]="activeTab === 'settings'" *ngIf="activeTab === 'settings'">
          <div class="settings-section">
            <h2>Account Settings</h2>
            <div class="settings-grid">
              <div class="setting-card">
                <h3>Personal Information</h3>
                <div class="setting-content">
                  <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" [value]="(user?.nom || '') + ' ' + (user?.['prénom'] || '')" readonly>
                  </div>
                  <div class="form-group">
                    <label>Email</label>
                    <input type="email" [value]="user?.email" readonly>
                  </div>
                  <button class="btn btn-outline">Edit Information</button>
                </div>
              </div>
              
              <div class="setting-card">
                <h3>Security</h3>
                <div class="setting-content">
                  <button class="btn btn-outline">Change Password</button>
                  <button class="btn btn-outline">Two-Factor Authentication</button>
                </div>
              </div>
              
              <div class="setting-card">
                <h3>Preferences</h3>
                <div class="setting-content">
                  <div class="form-group">
                    <label>
                      <input type="checkbox"> Email notifications
                    </label>
                  </div>
                  <div class="form-group">
                    <label>
                      <input type="checkbox"> SMS notifications
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </ng-container>
  </div>
</div> 