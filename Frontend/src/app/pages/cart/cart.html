<div class="cart-page">
  <div class="container">
    <!-- Luxury Page Header -->
    <div class="page-header">
      <h1 class="page-title">Luxury Cart Experience</h1>
      <nav class="breadcrumb">
        <a href="/">Home</a>
        <span class="separator">/</span>
        <span class="current">Shopping Cart</span>
      </nav>
    </div>

    <!-- Premium Loading State -->
    <div class="cart-loading" *ngIf="loading">
      <div class="cart-loading-spinner"></div>
      <p>Curating your luxury shopping experience...</p>
    </div>

    <!-- Luxury Error State -->
    <div class="error-message" *ngIf="error">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
      <span>{{ error }}</span>
    </div>

    <!-- Premium Success Banner -->
    <div class="success-message" *ngIf="orderSuccess">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22,4 12,14.01 9,11.01"></polyline>
      </svg>
      <div>
        <h3>Order Placed Successfully! ✨</h3>
        <p>Your luxury items are being prepared with utmost care...</p>
      </div>
    </div>

    <!-- Cart Content -->
    <div class="cart-layout" *ngIf="!loading">
      <!-- Cart Items -->
      <div class="cart-items">
        <div class="cart-header">
          <h2>Cart Items ({{ getTotalItems() }})</h2>
          <button class="clear-cart-btn" (click)="clearCart()" [disabled]="isCartEmpty()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 6h18"></path>
              <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
              <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
            </svg>
            Clear All
          </button>
        </div>

        <!-- Luxury Cart Items List -->
        <div class="cart-items-list">
          <div 
            class="cart-item" 
            *ngFor="let item of cartItems; trackBy: trackByCartItem">
            <div class="item-image">
              <img [src]="item.product.image || 'https://via.placeholder.com/400x400/7c77c6/ffffff?text=Luxury+Product'" [alt]="item.product.title">
            </div>
            
            <div class="item-details">
              <h3 class="item-name">{{ getItemDisplayName(item) }}</h3>
              <p class="item-category">{{ item.product['category'] || 'Premium Collection' }}</p>
              
              <!-- Luxury Item Options Display -->
              <div class="item-options" *ngIf="item.selectedColor || item.selectedSize">
                <div *ngIf="item.selectedColor" class="item-option">
                  <span class="color-dot" [style.background-color]="getColorCode(item.selectedColor)"></span>
                  <span>{{ item.selectedColor }}</span>
                </div>
                <div *ngIf="item.selectedSize" class="item-option">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                  </svg>
                  <span>Size {{ item.selectedSize }}</span>
                </div>
              </div>
              
              <div class="item-price">
                <span class="current-price">{{ item.product.price | currency:'USD':'symbol':'1.2-2' }}</span>
                <span *ngIf="item.product['originalPrice']" class="original-price">
                  {{ item.product['originalPrice'] | currency:'USD':'symbol':'1.2-2' }}
                </span>
                <span *ngIf="item.product['originalPrice'] && item.product.price" class="discount-badge">
                  {{ ((item.product['originalPrice'] - item.product.price) / item.product['originalPrice'] * 100) | number:'1.0-0' }}% OFF
                </span>
              </div>
            </div>

            <div class="item-quantity">
              <div class="quantity-controls">
                <button 
                  class="qty-btn" 
                  (click)="decreaseQuantity(item)" 
                  [disabled]="item.quantity <= 1">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="6" y1="12" x2="18" y2="12"></line>
                  </svg>
                </button>
                <span class="qty-display">{{ item.quantity }}</span>
                <button class="qty-btn" (click)="increaseQuantity(item)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="6" x2="12" y2="18"></line>
                    <line x1="6" y1="12" x2="18" y2="12"></line>
                  </svg>
                </button>
              </div>
            </div>

            <div class="item-total">
              <span class="total-price">{{ getItemTotal(item) | currency:'USD':'symbol':'1.2-2' }}</span>
            </div>

            <div class="item-actions">
              <button 
                class="remove-btn" 
                (click)="removeItem(item)"
                [attr.aria-label]="'Remove ' + item.product.title + ' from cart'">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Luxury Empty Cart State -->
        <div class="empty-cart" *ngIf="isCartEmpty()">
          <div class="empty-cart-icon">
            <svg width="120" height="120" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg>
          </div>
          <h3>Your Luxury Cart Awaits</h3>
          <p>Discover our exclusive collection and curate your perfect selection!</p>
          <button class="continue-shopping-btn" (click)="continueShopping()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 12H6m6-7l-7 7 7 7"></path>
            </svg>
            <span>Explore Collections</span>
          </button>
        </div>
      </div>

      <!-- Cart Summary -->
      <div class="cart-summary" *ngIf="!isCartEmpty()">
        <div class="summary-card">
          <h3 class="summary-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 11H5a2 2 0 0 0-2 2v3c0 1.1.9 2 2 2h2"></path>
              <path d="M11 13h10l-3-3"></path>
              <path d="M11 17h10l-3 3"></path>
            </svg>
            Order Summary
          </h3>
          
          <div class="summary-items">
            <div class="summary-item">
              <span>Subtotal ({{ getTotalItems() }} {{ getTotalItems() === 1 ? 'item' : 'items' }})</span>
              <span class="summary-value">{{ getSubtotal() | currency:'USD':'symbol':'1.2-2' }}</span>
            </div>
            <div class="summary-item">
              <span>Premium Shipping</span>
              <span class="summary-value" [class.free]="getShippingCost() === 0">
                {{ getShippingCost() === 0 ? 'FREE' : (getShippingCost() | currency:'USD':'symbol':'1.2-2') }}
              </span>
            </div>
            <div class="summary-item">
              <span>Tax</span>
              <span class="summary-value">{{ getTax() | currency:'USD':'symbol':'1.2-2' }}</span>
            </div>
            <div class="summary-item discount" *ngIf="getDiscount() > 0">
              <span>Luxury Discount</span>
              <span class="summary-value discount-amount">-{{ getDiscount() | currency:'USD':'symbol':'1.2-2' }}</span>
            </div>
          </div>

          <div class="summary-total">
            <span class="total-label">Total</span>
            <span class="total-amount">{{ getTotal() | currency:'USD':'symbol':'1.2-2' }}</span>
          </div>

          <!-- Luxury Promo Code Section -->
          <div class="promo-code">
            <label class="promo-label">Have a luxury promo code?</label>
            <div class="promo-input">
              <input 
                type="text" 
                placeholder="Enter your exclusive code" 
                class="promo-field"
                [(ngModel)]="promoCode"
                [disabled]="promoCodeApplied">
              <button 
                class="apply-promo-btn" 
                (click)="applyPromoCode()"
                [disabled]="promoCodeApplied || !promoCode.trim()">
                {{ promoCodeApplied ? '✓ Applied' : 'Apply' }}
              </button>
            </div>
            <div class="promo-message" *ngIf="promoCodeMessage" [class.success]="promoCodeApplied">
              {{ promoCodeMessage }}
            </div>
          </div>

          <!-- Ultra-Premium Checkout Button -->
          <button 
            class="checkout-btn" 
            (click)="proceedToCheckout()" 
            [disabled]="isCartEmpty() || isProcessingOrder"
            [class.loading]="isProcessingOrder">
            <div class="checkout-btn-content" *ngIf="!isProcessingOrder">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
              </svg>
              <span>Secure Luxury Checkout</span>
            </div>
            <div class="checkout-btn-content" *ngIf="isProcessingOrder">
              <div class="loading-spinner"></div>
              <span>Processing Your Order...</span>
            </div>
          </button>

          <!-- Emergency Fix Button (temporary) -->
          <button 
            class="emergency-fix-btn" 
            (click)="emergencyFixUser()" 
            style="margin-top: 10px; background: #ff6b6b; color: white; padding: 8px 16px; border: none; border-radius: 8px; cursor: pointer; font-size: 12px;"
            title="Click this if checkout fails with 'User not found' error">
            🔧 Fix User Error
          </button>

          <div class="secure-checkout">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"></path>
              <path d="M21 12c.552 0 1-.448 1-1s-.448-1-1-1"></path>
            </svg>
            <span>Bank-grade security • Your data is fully protected</span>
          </div>
        </div>

        <!-- Luxury Payment Methods -->
        <div class="payment-methods">
          <h4>Accepted Payment Methods</h4>
          <div class="payment-icons">
            <div class="payment-icon visa" title="Visa">
              <span>💳</span>
            </div>
            <div class="payment-icon mastercard" title="Mastercard">
              <span>💳</span>
            </div>
            <div class="payment-icon amex" title="American Express">
              <span>💎</span>
            </div>
            <div class="payment-icon paypal" title="PayPal">
              <span>🅿️</span>
            </div>
            <div class="payment-icon crypto" title="Cryptocurrency">
              <span>₿</span>
            </div>
          </div>
          
          <div class="security-badges">
            <div class="security-badge">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
              </svg>
              <span>SSL Secured</span>
            </div>
            <div class="security-badge">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"></path>
                <path d="M21 12c.552 0 1-.448 1-1s-.448-1-1-1"></path>
              </svg>
              <span>PCI Compliant</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Luxury Recommended Collection -->
    <div class="recommended-section" *ngIf="recommendedProducts.length > 0 && !isCartEmpty()">
      <h2 class="section-title">Curated for You</h2>
      <div class="products-grid">
        <app-product-card 
          *ngFor="let product of recommendedProducts; trackBy: trackByProduct" 
          [product]="product">
        </app-product-card>
      </div>
    </div>
  </div>
</div>
