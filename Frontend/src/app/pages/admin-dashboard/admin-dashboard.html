<div class="admin-dashboard">
  <!-- Animated Background Elements -->
  <div class="floating-elements">
    <div class="floating-element"></div>
    <div class="floating-element"></div>
    <div class="floating-element"></div>
  </div>
  
  <!-- Sidebar Navigation -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      <div class="logo">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        <span class="logo-text" *ngIf="!sidebarCollapsed">E-Shop Admin</span>
      </div>
      <button class="sidebar-toggle" (click)="toggleSidebar()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
      </button>
    </div>
    
    <nav class="sidebar-nav">
      <a class="nav-item" [class.active]="activeTab === 'dashboard'" (click)="setActiveTab('dashboard')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        </svg>
        <span *ngIf="!sidebarCollapsed">Dashboard</span>
      </a>
      
      <a class="nav-item" [class.active]="activeTab === 'products'" (click)="setActiveTab('products')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M16 11V7a4 4 0 0 0-8 0v4M5 9h14l1 12H4l1-12z"/>
        </svg>
        <span *ngIf="!sidebarCollapsed">Products</span>
      </a>
      
      <a class="nav-item" [class.active]="activeTab === 'orders'" (click)="setActiveTab('orders')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
        </svg>
        <span *ngIf="!sidebarCollapsed">Orders</span>
      </a>
      
      <a class="nav-item" [class.active]="activeTab === 'users'" (click)="setActiveTab('users')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
        </svg>
        <span *ngIf="!sidebarCollapsed">Users</span>
      </a>
    </nav>
    
    <div class="sidebar-footer">
      <button class="logout-btn" (click)="logout()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
        </svg>
        <span *ngIf="!sidebarCollapsed">Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content" [class.expanded]="sidebarCollapsed">
    <!-- Top Header -->
    <header class="top-header">
      <div class="header-left">
        <h1>{{ getPageTitle() }}</h1>
      </div>
      
      <div class="header-right">
        <div class="search-box">
          <input type="text" placeholder="Search..." [(ngModel)]="searchTerm">
        </div>
        
        <button class="refresh-btn" (click)="refreshDashboard()" title="Refresh Dashboard">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23,4 23,10 17,10"/>
            <polyline points="1,20 1,14 7,14"/>
            <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4a9,9,0,0,1-14.85,3.36L23,14"/>
          </svg>
        </button>
        
        <div class="user-menu">
          <div class="user-avatar">
            <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop" alt="Admin">
          </div>
        </div>
      </div>
    </header>

    <!-- Dashboard Content -->
    <div class="content-area">
      <!-- Error Message -->
      <div *ngIf="errorMessage" class="message error">
        {{ errorMessage }}
        <button class="retry-btn" (click)="refreshDashboard()">Retry</button>
      </div>
      
      <!-- Dashboard Tab -->
      <div class="tab-content" [class.active]="activeTab === 'dashboard'" *ngIf="activeTab === 'dashboard'">
        <!-- Statistics Cards -->
        <div class="stats-grid">
          <div class="stat-card gradient-1" (click)="setActiveTab('products')">
            <div class="stat-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 11V7a4 4 0 0 0-8 0v4M5 9h14l1 12H4l1-12z"/>
              </svg>
            </div>
            <div class="stat-content">
              <h3>{{ stats.totalProducts }}</h3>
              <p>Products</p>
              <div class="stat-trend" [class]="stats.totalProducts > 0 ? 'positive' : 'neutral'">{{ growthMetrics.productsGrowth }}</div>
            </div>
          </div>

          <div class="stat-card gradient-2" (click)="setActiveTab('orders')">
            <div class="stat-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
              </svg>
            </div>
            <div class="stat-content">
              <h3>{{ stats.totalOrders }}</h3>
              <p>Orders</p>
              <div class="stat-trend" [class]="stats.totalOrders > 0 ? 'positive' : 'neutral'">{{ growthMetrics.ordersGrowth }}</div>
            </div>
          </div>

          <div class="stat-card gradient-3" (click)="setActiveTab('users')">
            <div class="stat-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              </svg>
            </div>
            <div class="stat-content">
              <h3>{{ stats.totalUsers }}</h3>
              <p>Users</p>
              <div class="stat-trend" [class]="stats.totalUsers > 0 ? 'positive' : 'neutral'">{{ growthMetrics.usersGrowth }}</div>
            </div>
          </div>

          <div class="stat-card gradient-4">
            <div class="stat-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
              </svg>
            </div>
            <div class="stat-content">
              <h3>${{ stats.totalRevenue | number:'1.2-2' }}</h3>
              <p>Revenue</p>
              <div class="stat-trend" [class]="stats.totalRevenue > 0 ? 'positive' : 'neutral'">{{ growthMetrics.revenueGrowth }}</div>
            </div>
          </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="quick-actions-section">
          <h2>Quick Actions</h2>
          <div class="actions-grid">
            <div class="action-card" (click)="setActiveTab('products')">
              <div class="action-icon gradient-1">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
              </div>
              <h3>Add Product</h3>
              <p>Create a new product for your store</p>
            </div>

            <div class="action-card" (click)="setActiveTab('orders')">
              <div class="action-icon gradient-2">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              </div>
              <h3>View Orders</h3>
              <p>Manage and track customer orders</p>
            </div>

            <div class="action-card" (click)="setActiveTab('users')">
              <div class="action-icon gradient-3">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="8.5" cy="7" r="4"/>
                  <line x1="20" y1="8" x2="20" y2="14"/>
                  <line x1="23" y1="11" x2="17" y2="11"/>
                </svg>
              </div>
              <h3>Manage Users</h3>
              <p>Control user accounts and permissions</p>
            </div>

            <div class="action-card" (click)="generateReport()">
              <div class="action-icon gradient-4">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14,2 14,8 20,8"/>
                  <line x1="16" y1="13" x2="8" y2="13"/>
                  <line x1="16" y1="17" x2="8" y2="17"/>
                  <polyline points="10,9 9,9 8,9"/>
                </svg>
              </div>
              <h3>Generate Report</h3>
              <p>Create detailed business reports</p>
            </div>
          </div>
        </div>

        <!-- Recent Activity Section -->
        <div class="recent-activity-section">
          <div class="activity-grid">
            <!-- Recent Orders -->
            <div class="activity-card">
              <div class="card-header">
                <h3>Recent Orders</h3>
                <button class="btn-text" (click)="setActiveTab('orders')">View All</button>
              </div>
              <div class="card-content">
                <div *ngIf="isLoading.orders" class="loading-state">
                  <div class="spinner"></div>
                  <span>Loading...</span>
                </div>
                <div *ngIf="!isLoading.orders && recentOrders.length > 0" class="items-list">
                  <div *ngFor="let order of recentOrders" class="item">
                    <div class="item-info">
                      <h4>Order #{{ order.id }}</h4>
                      <p>{{ formatDate(order.date || order.dateCommande) }} - ${{ (order.total || order.montantTotal || 0) | number:'1.2-2' }}</p>
                    </div>
                    <span [class]="'item-status ' + getOrderStatusClass(order.status || order.statut || 'pending')">
                      {{ order.status || order.statut || 'pending' }}
                    </span>
                  </div>
                </div>
                <div *ngIf="!isLoading.orders && recentOrders.length === 0" class="empty-state">
                  <p>No recent orders</p>
                </div>
              </div>
            </div>

            <!-- Recent Products -->
            <div class="activity-card">
              <div class="card-header">
                <h3>Recent Products</h3>
                <button class="btn-text" (click)="setActiveTab('products')">View All</button>
              </div>
              <div class="card-content">
                <div *ngIf="isLoading.products" class="loading-state">
                  <div class="spinner"></div>
                  <span>Loading...</span>
                </div>
                <div *ngIf="!isLoading.products && recentProducts.length > 0" class="items-list">
                  <div *ngFor="let product of recentProducts" class="item">
                    <div class="item-info">
                      <h4>{{ product.title || product.nom }}</h4>
                      <p>${{ (product.price || product.prix || 0) | number:'1.2-2' }} - Stock: {{ product.stock || 0 }}</p>
                    </div>
                    <span class="item-status active">Active</span>
                  </div>
                </div>
                <div *ngIf="!isLoading.products && recentProducts.length === 0" class="empty-state">
                  <p>No recent products</p>
                </div>
              </div>
            </div>

            <!-- Recent Users -->
            <div class="activity-card">
              <div class="card-header">
                <h3>Recent Users</h3>
                <button class="btn-text" (click)="setActiveTab('users')">View All</button>
              </div>
              <div class="card-content">
                <div *ngIf="isLoading.users" class="loading-state">
                  <div class="spinner"></div>
                  <span>Loading...</span>
                </div>
                <div *ngIf="!isLoading.users && recentUsers.length > 0" class="items-list">
                  <div *ngFor="let user of recentUsers" class="item">
                    <div class="item-info">
                      <h4>{{ (user['prénom'] || user.prenom || '') + ' ' + (user.nom || '') }}</h4>
                      <p>{{ user.email }}</p>
                    </div>
                    <span [class]="'item-status ' + (isAdmin(user.email || '') ? 'admin' : 'user')">
                      {{ isAdmin(user.email || '') ? 'Admin' : 'User' }}
                    </span>
                  </div>
                </div>
                <div *ngIf="!isLoading.users && recentUsers.length === 0" class="empty-state">
                  <p>No recent users</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CRUD Management Tabs -->
      <div class="tab-content" [class.active]="activeTab === 'products'" *ngIf="activeTab === 'products'">
        <app-product-crud></app-product-crud>
      </div>

      <div class="tab-content" [class.active]="activeTab === 'orders'" *ngIf="activeTab === 'orders'">
        <app-order-crud></app-order-crud>
      </div>

      <div class="tab-content" [class.active]="activeTab === 'users'" *ngIf="activeTab === 'users'">
        <app-user-crud></app-user-crud>
      </div>
    </div>
  </main>
</div>
