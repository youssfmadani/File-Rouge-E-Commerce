<div class="product-crud">
  <!-- Header Section -->
  <div class="crud-header">
    <div class="header-left">
      <h2>Product Management</h2>
      <p>Manage your product inventory</p>
    </div>
    <button class="btn btn-primary" (click)="showAddProductForm()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
      Add Product
    </button>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="message success">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M9 12l2 2 4-4"/>
      <circle cx="12" cy="12" r="10"/>
    </svg>
    {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="message error">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"/>
      <line x1="15" y1="9" x2="9" y2="15"/>
      <line x1="9" y1="9" x2="15" y2="15"/>
    </svg>
    {{ errorMessage }}
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters">
      <div class="search-filter">
        <input 
          type="text" 
          class="search-input" 
          placeholder="Search products..." 
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
        >
      </div>
      <div class="category-filter">
        <select 
          class="category-select" 
          [(ngModel)]="selectedCategory"
          (change)="onCategoryChange()"
        >
          <option value="">All Categories</option>
          <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Products Table -->
  <div class="products-section">
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <span>Loading products...</span>
    </div>

    <div *ngIf="!isLoading && filteredProducts.length > 0" class="products-table">
      <div class="table-header">
        <div class="header-cell">Product</div>
        <div class="header-cell">Category</div>
        <div class="header-cell">Price</div>
        <div class="header-cell">Stock</div>
        <div class="header-cell">Actions</div>
      </div>

      <div *ngFor="let product of filteredProducts" class="table-row">
        <div class="cell product-cell">
          <div class="product-info">
            <img 
              [src]="product.imageUrl || product.image || 'https://via.placeholder.com/60x60'" 
              [alt]="getProductTitle(product)"
              class="product-image"
              onerror="this.src='https://via.placeholder.com/60x60'"
            >
            <div class="product-details">
              <h4>{{ getProductTitle(product) }}</h4>
              <p>{{ product.description || 'No description available' }}</p>
            </div>
          </div>
        </div>
        <div class="cell">{{ getProductCategory(product) }}</div>
        <div class="cell">${{ getProductPrice(product) | number:'1.2-2' }}</div>
        <div class="cell">
          <span class="stock-badge" [class.low-stock]="(product.stock || 0) < 10">
            {{ product.stock || 0 }}
          </span>
        </div>
        <div class="cell actions-cell">
          <button class="btn btn-sm btn-outline" (click)="editProduct(product)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Edit
          </button>
          <button class="btn btn-sm btn-danger" (click)="deleteProduct(product)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3,6 5,6 21,6"/>
              <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2v2"/>
            </svg>
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && filteredProducts.length === 0" class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
        <path d="M16 11V7a4 4 0 0 0-8 0v4M5 9h14l1 12H4l1-12z"/>
      </svg>
      <h3>No Products Found</h3>
      <p>{{ searchTerm || selectedCategory ? 'No products match your filters' : 'Start by adding your first product' }}</p>
      <button *ngIf="!searchTerm && !selectedCategory" class="btn btn-primary" (click)="showAddProductForm()">
        Add Your First Product
      </button>
    </div>
  </div>
</div>

<!-- Product Form Modal -->
<div *ngIf="showAddForm" class="modal-overlay" (click)="hideAddForm()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ editingProduct ? 'Edit Product' : 'Add New Product' }}</h2>
      <button class="close-btn" (click)="hideAddForm()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <form class="product-form" (ngSubmit)="saveProduct()">
      <div class="form-grid">
        <div class="form-group">
          <label for="title">Product Name *</label>
          <input 
            type="text" 
            id="title"
            class="form-input" 
            [(ngModel)]="newProduct.title"
            name="title"
            required
            placeholder="Enter product name"
          >
        </div>

        <div class="form-group">
          <label for="category">Category *</label>
          <select 
            id="category"
            class="form-input" 
            [(ngModel)]="newProduct.category"
            name="category"
            required
          >
            <option value="">Select category</option>
            <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
          </select>
        </div>

        <div class="form-group">
          <label for="price">Price *</label>
          <input 
            type="number" 
            id="price"
            class="form-input" 
            [(ngModel)]="newProduct.price"
            name="price"
            required
            min="0"
            step="0.01"
            placeholder="0.00"
          >
        </div>

        <div class="form-group">
          <label for="stock">Stock Quantity</label>
          <input 
            type="number" 
            id="stock"
            class="form-input" 
            [(ngModel)]="newProduct.stock"
            name="stock"
            min="0"
            placeholder="0"
          >
        </div>

        <div class="form-group full-width">
          <label for="imageUrl">Image URL</label>
          <input 
            type="url" 
            id="imageUrl"
            class="form-input" 
            [(ngModel)]="newProduct.imageUrl"
            name="imageUrl"
            placeholder="https://example.com/image.jpg"
          >
        </div>

        <div class="form-group full-width">
          <label for="description">Description</label>
          <textarea 
            id="description"
            class="form-input" 
            [(ngModel)]="newProduct.description"
            name="description"
            rows="3"
            placeholder="Product description..."
          ></textarea>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="hideAddForm()">Cancel</button>
        <button type="submit" class="btn btn-primary">
          {{ editingProduct ? 'Update Product' : 'Create Product' }}
        </button>
      </div>
    </form>
  </div>
</div>