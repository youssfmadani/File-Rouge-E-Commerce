<div class="user-crud">
  <!-- Header Section -->
  <div class="crud-header">
    <div class="header-left">
      <h2>User Management</h2>
      <p>Manage user accounts and permissions</p>
    </div>
    <div class="header-stats">
      <div class="stat-item">
        <span class="stat-number">{{ getAdminCount() }}</span>
        <span class="stat-label">Admins</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{ getRegularUserCount() }}</span>
        <span class="stat-label">Users</span>
      </div>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="message success">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M9 12l2 2 4-4"/>
      <circle cx="12" cy="12" r="10"/>
    </svg>
    {{ successMessage }}
  </div>

  <div *ngIf="errorMessage" class="message error">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"/>
      <line x1="15" y1="9" x2="9" y2="15"/>
      <line x1="9" y1="9" x2="15" y2="15"/>
    </svg>
    {{ errorMessage }}
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters">
      <div class="search-filter">
        <input 
          type="text" 
          class="search-input" 
          placeholder="Search users by name or email..." 
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
        >
      </div>
      <div class="role-filter">
        <select 
          class="role-select" 
          [(ngModel)]="selectedRole"
          (change)="onRoleChange()"
        >
          <option value="">All Roles</option>
          <option *ngFor="let role of roleOptions" [value]="role">
            {{ role | titlecase }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <!-- Users Table -->
  <div class="users-section">
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <span>Loading users...</span>
    </div>

    <div *ngIf="!isLoading && filteredUsers.length > 0" class="users-table">
      <div class="table-header">
        <div class="header-cell">User</div>
        <div class="header-cell">Email</div>
        <div class="header-cell">Role</div>
        <div class="header-cell">Join Date</div>
        <div class="header-cell">Actions</div>
      </div>

      <div *ngFor="let user of filteredUsers" class="table-row">
        <div class="cell user-cell" data-label="User">
          <div class="user-info">
            <div class="user-avatar">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
            </div>
            <div class="user-details">
              <div class="user-name">{{ getUserName(user) }}</div>
              <div class="user-id">ID: {{ user.id }}</div>
            </div>
          </div>
        </div>
        
        <div class="cell email-cell" data-label="Email">
          {{ user.email }}
        </div>
        
        <div class="cell role-cell" data-label="Role">
          <span [class]="'role-badge ' + getRoleClass(user)">
            {{ getUserRole(user) }}
          </span>
        </div>
        
        <div class="cell date-cell" data-label="Join Date">
          {{ getJoinDate(user) }}
        </div>
        
        <div class="cell actions-cell" data-label="Actions">
          <button class="btn btn-sm btn-outline" (click)="viewUserDetails(user)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            View
          </button>
          
          <button 
            *ngIf="!isAdmin(user.email || '')"
            class="btn btn-sm btn-primary" 
            (click)="makeAdmin(user)"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            Make Admin
          </button>
          
          <span *ngIf="isAdmin(user.email || '')" class="admin-badge">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            Admin
          </span>
          
          <button class="btn btn-sm btn-danger" (click)="deleteUser(user)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3,6 5,6 21,6"/>
              <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2v2"/>
            </svg>
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && filteredUsers.length === 0" class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
      <h3>No Users Found</h3>
      <p>{{ searchTerm || selectedRole ? 'No users match your filters' : 'No users registered yet' }}</p>
    </div>
  </div>
</div>

<!-- User Details Modal -->
<div *ngIf="showDetailsModal && selectedUser" class="modal-overlay" (click)="hideDetailsModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>User Details</h2>
      <button class="close-btn" (click)="hideDetailsModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="user-details">
        <!-- User Avatar and Basic Info -->
        <div class="user-profile">
          <div class="profile-avatar">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </div>
          <div class="profile-info">
            <h3>{{ getUserName(selectedUser) }}</h3>
            <span [class]="'role-badge ' + getRoleClass(selectedUser)">
              {{ getUserRole(selectedUser) }}
            </span>
          </div>
        </div>

        <!-- User Information -->
        <div class="detail-section">
          <h3>Personal Information</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>User ID:</label>
              <span>{{ selectedUser.id }}</span>
            </div>
            <div class="detail-item">
              <label>First Name:</label>
              <span>{{ selectedUser['pr√©nom'] || selectedUser.prenom || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Last Name:</label>
              <span>{{ selectedUser.nom || 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Email:</label>
              <span>{{ selectedUser.email }}</span>
            </div>
            <div class="detail-item">
              <label>Join Date:</label>
              <span>{{ getJoinDate(selectedUser) }}</span>
            </div>
            <div class="detail-item">
              <label>Role:</label>
              <span [class]="'role-badge ' + getRoleClass(selectedUser)">
                {{ getUserRole(selectedUser) }}
              </span>
            </div>
          </div>
        </div>

        <!-- Additional Information -->
        <div class="detail-section" *ngIf="selectedUser['phone'] || selectedUser['address']">
          <h3>Contact Information</h3>
          <div class="detail-grid">
            <div class="detail-item" *ngIf="selectedUser['phone']">
              <label>Phone:</label>
              <span>{{ selectedUser['phone'] }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedUser['address']">
              <label>Address:</label>
              <span>{{ selectedUser['address'] }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="hideDetailsModal()">Close</button>
      <button 
        *ngIf="!isAdmin(selectedUser.email || '')"
        class="btn btn-primary" 
        (click)="makeAdmin(selectedUser); hideDetailsModal()"
      >
        Make Admin
      </button>
    </div>
  </div>
</div>