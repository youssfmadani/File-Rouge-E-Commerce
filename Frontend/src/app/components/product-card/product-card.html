<div class="product-card" [class.list-view]="viewMode === 'list'" [class.grid-view]="viewMode === 'grid'">
  <!-- Product Image Container -->
  <div class="product-image-container">
    <div class="product-image">
      <img [src]="getProductImage()" 
           [alt]="getProductTitle()"
           loading="lazy"
           (click)="viewProductDetails()" *ngIf="getProductImage(); else noImage">
      
      <!-- Product Badges -->
      <div class="product-badges">
        <span class="badge badge-new" *ngIf="product && product.isNew">NEW</span>
        <span class="badge badge-sale" *ngIf="hasDiscount()">-{{getDiscountPercent()}}%</span>
        <span class="badge badge-featured" *ngIf="product && product.isFeatured">FEATURED</span>
        <span class="badge badge-limited" *ngIf="isLowStock()">LIMITED</span>
      </div>
      
      <!-- Hover Actions -->
      <div class="product-hover-actions">
        <button class="action-btn" (click)="openQuickView()" title="Quick View">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
        <button class="action-btn" (click)="onAddToWishlist()" title="Add to Wishlist">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
        </button>
        <button class="action-btn" (click)="onAddToCompare()" title="Compare">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 19v-6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2z"></path>
            <path d="M21 19v-6a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2z"></path>
            <path d="M9 10V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2z"></path>
          </svg>
        </button>
      </div>
      
      <!-- Availability Indicator -->
      <div class="availability-indicator" [class.in-stock]="isInStock()" [class.low-stock]="isLowStock()" [class.out-of-stock]="isOutOfStock()">
        <span class="availability-dot"></span>
        <span class="availability-text">{{ getAvailabilityText() }}</span>
      </div>
    </div>
  </div>
  
  <!-- Product Content -->
  <div class="product-content">
    <!-- Product Category -->
    <div class="product-category" *ngIf="getProductCategory()">
      <span class="category-label">{{ getProductCategory() }}</span>
    </div>
    
    <!-- Product Title -->
    <h3 class="product-title" (click)="viewProductDetails()">{{ getProductTitle() }}</h3>
    
    <!-- Product Description (List View Only) -->
    <p class="product-description" *ngIf="viewMode === 'list' && getProductDescription()">
      {{ getProductDescription() }}
    </p>
    
    <!-- Product Rating -->
    <div class="product-rating" *ngIf="getProductRating() || getProductRating() === 0">
      <div class="stars">
        <span class="star" 
              *ngFor="let star of getStarArray(getProductRating()); let i = index" 
              [class.filled]="star === 1">
          {{ star === 1 ? '★' : '☆' }}
        </span>
      </div>
      <span class="rating-value">{{ getProductRating() }}</span>
      <span class="review-count" *ngIf="getReviewCount() && getReviewCount() > 0">({{ getReviewCount() }} reviews)</span>
    </div>
    
    <!-- Product Features (List View Only) -->
    <div class="product-features" *ngIf="viewMode === 'list' && getProductFeatures() && getProductFeatures().length > 0">
      <span class="feature-tag" *ngFor="let feature of getProductFeatures().slice(0, 3)">{{ feature }}</span>
    </div>
    
    <!-- Product Price -->
    <div class="product-pricing">
      <div class="price-main">
        <span class="current-price">{{ getProductPrice() | currency:'USD':'symbol':'1.2-2' }}</span>
        <span class="original-price" *ngIf="getOriginalPrice() > getProductPrice()">
          {{ getOriginalPrice() | currency:'USD':'symbol':'1.2-2' }}
        </span>
      </div>
      <div class="price-savings" *ngIf="getOriginalPrice() > getProductPrice()">
        Save {{ getSavingsAmount() | currency:'USD':'symbol':'1.2-2' }}
      </div>
    </div>
    
    <!-- Product Actions -->
    <div class="product-actions">
      <button class="btn btn-primary btn-add-cart" (click)="onAddToCart()" [disabled]="isOutOfStock()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <path d="M16 10a4 4 0 0 1-8 0"></path>
        </svg>
        <span>{{ isOutOfStock() ? 'Out of Stock' : 'Add to Cart' }}</span>
      </button>
      
      <div class="secondary-actions" *ngIf="viewMode === 'grid'">
        <button class="btn btn-secondary btn-sm" (click)="onBuyNow()" [disabled]="isOutOfStock()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20,6 9,17 4,12"></polyline>
          </svg>
          Buy Now
        </button>
      </div>
      
      <!-- List View Extended Actions -->
      <div class="extended-actions" *ngIf="viewMode === 'list'">
        <button class="btn btn-secondary" (click)="onBuyNow()" [disabled]="isOutOfStock()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20,6 9,17 4,12"></polyline>
          </svg>
          Buy Now
        </button>
        <button class="btn btn-outline" (click)="openQuickView()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
          Quick View
        </button>
      </div>
    </div>
    
    <!-- Product Meta (List View Only) -->
    <div class="product-meta" *ngIf="viewMode === 'list'">
      <div class="meta-item" *ngIf="getProductBrand()">
        <span class="meta-label">Brand:</span>
        <span class="meta-value">{{ getProductBrand() }}</span>
      </div>
      <div class="meta-item" *ngIf="getProductSKU()">
        <span class="meta-label">SKU:</span>
        <span class="meta-value">{{ getProductSKU() }}</span>
      </div>
      <div class="meta-item" *ngIf="getStockQuantity() !== undefined && getStockQuantity() >= 0">
        <span class="meta-label">Stock:</span>
        <span class="meta-value" [class.low-stock]="isLowStock()" [class.out-of-stock]="isOutOfStock()">
          {{ getStockQuantity() }} units
        </span>
      </div>
    </div>
  </div>
</div>

<!-- No Image Placeholder -->
<ng-template #noImage>
  <div class="no-image-placeholder">
    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
      <circle cx="8.5" cy="8.5" r="1.5"></circle>
      <polyline points="21 15 16 10 5 21"></polyline>
    </svg>
  </div>
</ng-template>

<!-- Quick View Modal -->
<div class="quick-view-modal" [class.active]="showQuickView" (click)="closeQuickView()">
  <div class="quick-view-backdrop"></div>
  <div class="quick-view-content" (click)="$event.stopPropagation()">
    <button class="quick-view-close" (click)="closeQuickView()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
    
    <div class="quick-view-layout">
      <div class="quick-view-image">
        <img [src]="getProductImage()" 
             [alt]="getProductTitle()" *ngIf="getProductImage(); else noImageModal">
      </div>
      
      <div class="quick-view-details">
        <div class="quick-view-category" *ngIf="getProductCategory()">{{ getProductCategory() }}</div>
        <h3 class="quick-view-title">{{ getProductTitle() }}</h3>
        
        <div class="quick-view-rating" *ngIf="getProductRating() || getProductRating() === 0">
          <div class="stars">
            <span class="star" 
                  *ngFor="let star of getStarArray(getProductRating()); let i = index" 
                  [class.filled]="star === 1">
              {{ star === 1 ? '★' : '☆' }}
            </span>
          </div>
          <span class="rating-value">{{ getProductRating() }}</span>
          <span class="review-count" *ngIf="getReviewCount() && getReviewCount() > 0">({{ getReviewCount() }} reviews)</span>
        </div>
        
        <p class="quick-view-description" *ngIf="getProductDescription()">
          {{ getProductDescription() }}
        </p>
        
        <div class="quick-view-price">
          <span class="current-price">{{ getProductPrice() | currency:'USD':'symbol':'1.2-2' }}</span>
          <span class="original-price" *ngIf="getOriginalPrice() > getProductPrice()">
            {{ getOriginalPrice() | currency:'USD':'symbol':'1.2-2' }}
          </span>
        </div>
        
        <!-- Product Options -->
        <div class="quick-view-options">
          <div class="option-group">
            <label class="option-label">Color:</label>
            <div class="color-options">
              <button 
                *ngFor="let color of availableColors" 
                class="color-option" 
                [class.active]="selectedColor === color.name"
                [style.background-color]="color.code"
                [attr.title]="color.label"
                (click)="selectColor(color.name)">
                <span class="color-checkmark" *ngIf="selectedColor === color.name">✓</span>
              </button>
            </div>
          </div>

          <div class="option-group">
            <label class="option-label">Size:</label>
            <div class="size-options">
              <button 
                *ngFor="let size of availableSizes" 
                class="size-option" 
                [class.active]="selectedSize === size"
                (click)="selectSize(size)">
                {{ size }}
              </button>
            </div>
          </div>

          <div class="option-group">
            <label class="option-label">Quantity:</label>
            <div class="quantity-selector">
              <button class="qty-btn" (click)="decreaseQuantity()" [disabled]="quantity <= 1">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="6" y1="12" x2="18" y2="12"></line>
                </svg>
              </button>
              <input 
                type="number" 
                [value]="quantity" 
                (input)="updateQuantity($event)" 
                class="qty-input" 
                min="1" 
                max="99">
              <button class="qty-btn" (click)="increaseQuantity()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="6" x2="12" y2="18"></line>
                  <line x1="6" y1="12" x2="18" y2="12"></line>
                </svg>
              </button>
            </div>
          </div>
        </div>
        
        <div class="quick-view-actions">
          <button class="btn btn-primary" (click)="onAddToCart(); closeQuickView()" [disabled]="isOutOfStock()">
            {{ isOutOfStock() ? 'Out of Stock' : 'Add to Cart' }}
          </button>
          <button class="btn btn-secondary" (click)="onBuyNow(); closeQuickView()" [disabled]="isOutOfStock()">
            Buy Now
          </button>
          <button class="btn btn-outline" (click)="onAddToWishlist()">
            Add to Wishlist
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- No Image Placeholder for Modal -->
<ng-template #noImageModal>
  <div class="no-image-placeholder-modal">
    <svg width="128" height="128" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
      <circle cx="8.5" cy="8.5" r="1.5"></circle>
      <polyline points="21 15 16 10 5 21"></polyline>
    </svg>
  </div>
</ng-template>